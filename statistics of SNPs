##This is a python file code.
import math

def count_columns_with_index(file_path, index_path, output_path):
    try:
        # Read the index file
        with open(index_path, 'r') as index_file:
            # Make sure that the index file contains only one line
            index_line = index_file.readline().strip()

        # Read the input file
        with open(file_path, 'r') as file:
            lines = file.readlines()

        # Check if the data file is empty
        if not lines:
            print("error:empty file")
            return

        # Obtain the total number of rows
        total_lines = len(lines)

        # Obtain the total number of colums
        num_columns = len(index_line)

        # Initialize the list to store the results
        results = []

        # Traverse each column
        for col_index in range(num_columns):
            index_char = index_line[col_index]
            # jumpe'X'
            if index_char == 'X':
                continue

            # Initialize the counter
            count_dict = {}
            # Traverse each row
            for line in lines:
                # Remove the line break at the end of the line
                line = line.strip()
                # Get the characters of the current column
                char = line[col_index]
                # jumpe'X'
                if char == 'X':
                    continue
                # Count the characters that are different from the index characters
                if char != index_char:
                    if char not in count_dict:
                        count_dict[char] = 0
                    count_dict[char] += 1

            # Add the result to the list
            for letter, count in count_dict.items():
                prob = count / total_lines
                log10_prob = math.log10(prob) if prob > 0 else float('-inf')  # The logarithmic function is undefined at 0, which is represented by negative infinity.
                results.append((col_index + 1, letter, count, f"{index_char}{col_index + 1}{letter}", prob, log10_prob))

        # Write in the results
        with open(output_path, 'w') as output_file:
            # Write in the header
            output_file.write("Site\taa\tCount\tMut\tProb\tRange\n")
            # Write in the results
            for result in results:
                output_file.write(f"{result[0]}\t{result[1]}\t{result[2]}\t{result[3]}\t{result[4]:.4f}\t{result[5]:.4f}\n")

        print(f"Result successfully saved in {output_path}")
    except Exception as e:
        print(f"error: {e}")


file_path = r'C:\\aaaIMCAS\\PATH\\cow.txt'  # input file path
index_path = r'C:\\aaaIMCAS\\PATH\\cow-OH12.txt' # index file path
output_path = r'C:\\aaaIMCAS\\PATH\\output.txt'  # output file path
count_columns_with_index(file_path, index_path, output_path)
